<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ü–µ–Ω">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#121212">

  <!-- –ò–∫–æ–Ω–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω (—ç–º–æ–¥–∑–∏ üí∞) -->
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí∞</text></svg>">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí∞</text></svg>">

  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ü–µ–Ω</title>
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 16px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    h1 {
      margin: 0;
      color: #bb86fc;
      font-size: 20px;
    }

    #modeSelect {
      padding: 6px 10px;
      background: #2d2d2d;
      color: #e0e0e0;
      border: 1px solid #444;
      border-radius: 6px;
      font-size: 14px;
    }

    .rates {
      background: #2a2a2a;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 18px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 13px;
    }

    .rate-item {
      text-align: center;
      min-width: 90px;
    }

    .rate-value {
      color: #03dac6;
      font-weight: bold;
      display: block;
    }

    label {
      display: block;
      margin-top: 14px;
      margin-bottom: 4px;
      font-weight: 500;
      font-size: 14px;
    }

    input, select {
      width: 100%;
      padding: 9px;
      margin-bottom: 14px;
      background: #2d2d2d;
      color: #ffffff;
      border: 1px solid #444;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 14px;
    }

    button {
      width: 100%;
      padding: 11px;
      background: #03dac6;
      color: #000;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 8px;
      font-size: 15px;
    }

    .result {
      margin-top: 20px;
      padding: 16px;
      background: #2a2a2a;
      border-radius: 10px;
    }

    .rrc-box, .purchase-box {
      background: #1a1a1a;
      border: 2px solid #03dac6;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 16px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: #03dac6;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }

    .price-item {
      flex: 1;
      text-align: center;
    }

    .price-label {
      font-size: 13px;
      color: #aaa;
      margin-bottom: 4px;
    }

    .price-value {
      font-weight: bold;
      color: #03dac6;
      font-size: 15px;
    }

    .field-group {
      display: none;
    }

    .field-group.active {
      display: block;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–æ–∑–Ω–∏—á–Ω—ã—Ö —Ü–µ–Ω</h1>
      <select id="modeSelect" onchange="switchMode()">
        <option value="coefficient">–ß–µ—Ä–µ–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</option>
        <option value="targetRRP">–° —Ü–µ–ª–µ–≤–æ–π –†–†–¶</option>
      </select>
    </div>

    <div class="rates" id="rates">
      <div class="rate-item">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <!-- –†–µ–∂–∏–º 1: –ß–µ—Ä–µ–∑ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç -->
    <div id="mode1" class="field-group active">
      <label for="purchasePrice1">–ó–∞–∫—É–ø–æ—á–Ω–∞—è —Ü–µ–Ω–∞:</label>
      <input type="number" id="purchasePrice1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1000" step="0.01" min="0">

      <label for="currency1">–í–∞–ª—é—Ç–∞ –∑–∞–∫—É–ø–∫–∏:</label>
      <select id="currency1">
        <option value="CNY">–ö–∏—Ç–∞–π—Å–∫–∏–π —é–∞–Ω—å (CNY)</option>
        <option value="USD">–î–æ–ª–ª–∞—Ä –°–®–ê (USD)</option>
        <option value="EUR">–ï–≤—Ä–æ (EUR)</option>
      </select>

      <label for="costPercent1">–ü—Ä–æ—Ü–µ–Ω—Ç —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ (%):</label>
      <input type="number" id="costPercent1" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ" step="0.1" min="0">

      <label for="coefficient">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç:</label>
      <input type="number" id="coefficient" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 2.5" step="0.01" min="0">

      <label for="superDealerDiscount1">–°–∫–∏–¥–∫–∞ –¥–ª—è —Å—É–ø–µ—Ä-–¥–∏–ª–µ—Ä–∞:</label>
      <select id="superDealerDiscount1">
        <option value="15">15%</option>
        <option value="17">17%</option>
      </select>
    </div>

    <!-- –†–µ–∂–∏–º 2: –° —Ü–µ–ª–µ–≤–æ–π –†–†–¶ -->
    <div id="mode2" class="field-group">
      <label for="targetRRP">–¶–µ–ª–µ–≤–∞—è –†–†–¶ (‚ÇΩ):</label>
      <input type="number" id="targetRRP" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 25000" step="0.01" min="0">

      <label for="costPercent2">–ü—Ä–æ—Ü–µ–Ω—Ç —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ (%):</label>
      <input type="number" id="costPercent2" placeholder="–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ" step="0.1" min="0" required>

      <label for="superDealerMarkup">–ù–∞—Ü–µ–Ω–∫–∞ —Å—É–ø–µ—Ä-–¥–∏–ª–µ—Ä–∞ –∫ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ (%):</label>
      <input type="number" id="superDealerMarkup" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 25" step="0.1" min="0">

      <label for="currency2">–í–∞–ª—é—Ç–∞ –∑–∞–∫—É–ø–∫–∏ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç):</label>
      <select id="currency2">
        <option value="CNY">–ö–∏—Ç–∞–π—Å–∫–∏–π —é–∞–Ω—å (CNY)</option>
        <option value="USD">–î–æ–ª–ª–∞—Ä –°–®–ê (USD)</option>
        <option value="EUR">–ï–≤—Ä–æ (EUR)</option>
      </select>

      <label for="superDealerDiscount2">–°–∫–∏–¥–∫–∞ –¥–ª—è —Å—É–ø–µ—Ä-–¥–∏–ª–µ—Ä–∞:</label>
      <select id="superDealerDiscount2">
        <option value="15">15%</option>
        <option value="17">17%</option>
      </select>
    </div>

    <button onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

    <div class="result" id="result" style="display:none;">
      <!-- –î–ª—è —Ä–µ–∂–∏–º–∞ 1 -->
      <div id="resultMode1">
        <div class="rrc-box">
          –†–†–¶: <span id="retailPrice"></span> ‚ÇΩ
        </div>
        <div class="price-row">
          <div class="price-item">
            <div class="price-label">–î–∏–ª–µ—Ä</div>
            <div class="price-value" id="dealerPrice"></div>
          </div>
          <div class="price-item">
            <div class="price-label">–°—É–ø–µ—Ä-–¥–∏–ª–µ—Ä</div>
            <div class="price-value" id="superDealerPrice"></div>
          </div>
        </div>
        <div class="price-row" id="costMarkupRow" style="display:none;">
          <div class="price-item">
            <div class="price-label">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
            <div class="price-value" id="costPrice"></div>
          </div>
          <div class="price-item">
            <div class="price-label">–ù–∞—Ü–µ–Ω–∫–∞</div>
            <div class="price-value" id="markup"></div>
          </div>
        </div>
      </div>

      <!-- –î–ª—è —Ä–µ–∂–∏–º–∞ 2 -->
      <div id="resultMode2" style="display:none;">
        <div class="purchase-box">
          –ó–∞–∫—É–ø–∫–∞: <span id="calculatedPurchase"></span>
        </div>
        <div class="price-row">
          <div class="price-item">
            <div class="price-label">–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
            <div class="price-value" id="costPrice2"></div>
          </div>
          <div class="price-item">
            <div class="price-label">–°—É–ø–µ—Ä-–¥–∏–ª–µ—Ä</div>
            <div class="price-value" id="superDealerPrice2"></div>
          </div>
        </div>
        <div class="price-row">
          <div class="price-item">
            <div class="price-label">–î–∏–ª–µ—Ä</div>
            <div class="price-value" id="dealerPrice2"></div>
          </div>
          <div class="price-item">
            <div class="price-label">–†–†–¶</div>
            <div class="price-value" id="rrpCheck"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const fallbackRates = {
      USD: 92.50,
      EUR: 101.20,
      CNY: 12.80
    };

    let exchangeRates = fallbackRates;

    fetch('https://www.cbr-xml-daily.ru/daily_json.js')
      .then(response => response.ok ? response.json() : Promise.reject())
      .then(data => {
        const cnyRate = data.Valute.CNY ? (data.Valute.CNY.Value / data.Valute.CNY.Nominal) : fallbackRates.CNY;
        exchangeRates = {
          CNY: cnyRate,
          USD: data.Valute.USD.Value,
          EUR: data.Valute.EUR.Value
        };

        document.getElementById('rates').innerHTML = `
          <div class="rate-item">USD<br><span class="rate-value">${exchangeRates.USD.toFixed(4)} ‚ÇΩ</span></div>
          <div class="rate-item">EUR<br><span class="rate-value">${exchangeRates.EUR.toFixed(4)} ‚ÇΩ</span></div>
          <div class="rate-item">CNY<br><span class="rate-value">${cnyRate.toFixed(4)} ‚ÇΩ</span></div>
        `;
      })
      .catch(() => {
        document.getElementById('rates').innerHTML = `
          <div class="rate-item">USD<br><span class="rate-value">${fallbackRates.USD.toFixed(4)} ‚ÇΩ</span></div>
          <div class="rate-item">EUR<br><span class="rate-value">${fallbackRates.EUR.toFixed(4)} ‚ÇΩ</span></div>
          <div class="rate-item">CNY<br><span class="rate-value">${fallbackRates.CNY.toFixed(4)} ‚ÇΩ</span></div>
        `;
      });

    function switchMode() {
      const mode = document.getElementById('modeSelect').value;
      document.getElementById('mode1').classList.toggle('active', mode === 'coefficient');
      document.getElementById('mode2').classList.toggle('active', mode === 'targetRRP');
      document.getElementById('result').style.display = 'none';
    }

    function calculate() {
      const mode = document.getElementById('modeSelect').value;

      if (mode === 'coefficient') {
        calculateMode1();
      } else {
        calculateMode2();
      }
    }

    function calculateMode1() {
      const purchasePrice = parseFloat(document.getElementById('purchasePrice1').value);
      const currency = document.getElementById('currency1').value;
      const costPercentInput = document.getElementById('costPercent1').value.trim();
      const costPercent = costPercentInput === '' ? null : parseFloat(costPercentInput);
      const coefficient = parseFloat(document.getElementById('coefficient').value);
      const superDiscount = parseFloat(document.getElementById('superDealerDiscount1').value);

      if (isNaN(purchasePrice) || purchasePrice <= 0 || isNaN(coefficient) || coefficient <= 0) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ü–µ–Ω—ã –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞.');
        return;
      }

      const rate = exchangeRates[currency];
      const purchaseInRub = purchasePrice * rate;
      const retail = purchaseInRub * coefficient;
      const dealer = retail * 0.7;
      const superDealer = dealer * (1 - superDiscount / 100);

      document.getElementById('retailPrice').textContent = retail.toFixed(2);
      document.getElementById('dealerPrice').textContent = dealer.toFixed(2) + ' ‚ÇΩ';
      document.getElementById('superDealerPrice').textContent = superDealer.toFixed(2) + ' ‚ÇΩ';

      const costMarkupRow = document.getElementById('costMarkupRow');
      if (costPercent !== null && !isNaN(costPercent)) {
        const costPrice = purchaseInRub * (1 + costPercent / 100);
        const markupPercent = ((superDealer / costPrice) - 1) * 100;
        document.getElementById('costPrice').textContent = costPrice.toFixed(2) + ' ‚ÇΩ';
        document.getElementById('markup').textContent = markupPercent.toFixed(2) + '%';
        costMarkupRow.style.display = 'flex';
      } else {
        costMarkupRow.style.display = 'none';
      }

      document.getElementById('resultMode1').style.display = 'block';
      document.getElementById('resultMode2').style.display = 'none';
      document.getElementById('result').style.display = 'block';
    }

    function calculateMode2() {
      const targetRRP = parseFloat(document.getElementById('targetRRP').value);
      const costPercent = parseFloat(document.getElementById('costPercent2').value);
      const superDealerMarkup = parseFloat(document.getElementById('superDealerMarkup').value);
      const currency = document.getElementById('currency2').value;
      const superDiscount = parseFloat(document.getElementById('superDealerDiscount2').value);

      if (isNaN(targetRRP) || targetRRP <= 0) {
        alert('–£–∫–∞–∂–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é –†–†–¶.');
        return;
      }
      if (isNaN(costPercent) || costPercent < 0) {
        alert('–£–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ–Ω—Ç —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏.');
        return;
      }
      if (isNaN(superDealerMarkup) || superDealerMarkup < 0) {
        alert('–£–∫–∞–∂–∏—Ç–µ –Ω–∞—Ü–µ–Ω–∫—É —Å—É–ø–µ—Ä-–¥–∏–ª–µ—Ä–∞.');
        return;
      }

      const dealer = targetRRP * 0.7;
      const superDealer = dealer * (1 - superDiscount / 100);
      const costPrice = superDealer / (1 + superDealerMarkup / 100);
      const purchaseInRub = costPrice / (1 + costPercent / 100);
      const purchaseInCurrency = purchaseInRub / exchangeRates[currency];

      // –í—ã–≤–æ–¥
      const currencySymbol = currency === 'CNY' ? '¬•' : currency === 'USD' ? '$' : '‚Ç¨';
      document.getElementById('calculatedPurchase').textContent = purchaseInCurrency.toFixed(2) + ' ' + currencySymbol;

      document.getElementById('costPrice2').textContent = costPrice.toFixed(2) + ' ‚ÇΩ';
      document.getElementById('superDealerPrice2').textContent = superDealer.toFixed(2) + ' ‚ÇΩ';
      document.getElementById('dealerPrice2').textContent = dealer.toFixed(2) + ' ‚ÇΩ';
      document.getElementById('rrpCheck').textContent = targetRRP.toFixed(2) + ' ‚ÇΩ';

      document.getElementById('resultMode1').style.display = 'none';
      document.getElementById('resultMode2').style.display = 'block';
      document.getElementById('result').style.display = 'block';
    }
  </script>
</body>
</html>